@{
    ViewData["Title"] = "Produtos";
}

<h1>Produtos</h1>

<input type="button" class="btn btn-success" value="Criar Produto" onclick="location.href='@Url.Action("Inserir", "Produto")'" />

<table class="table">
    <thead>
        <th>Descrição</th>
        <th>Valor (R$)</th>
        <th>Quantidade em estoque</th>
        <th>Editar</th>
        <th>Deletar</th>
    </thead>
    <tbody id="corpoTabela" >
        @* Lista de produtos carregados separadamente para não travar tela *@
    </tbody>
</table>

@section Scripts
{
    <script>
        $(document).ready(function(){
            $.ajax({
                url: "/Produto/CarregarListaProdutosIndex",
                success: function(result){
                    var tbody = $('#corpoTabela');
                    for(var prod of result.produtos)
                    {
                        var node = "<tr>" + 
                            "<td><img style='width: 50px; heigth: 50px;' src='data:image/png;base64," + prod.imagem + "'></td>" +
                            "<td>" + prod.descricao + "</td>" +
                            "<td>" + prod.preco + "</td>" +
                            "<td>" + prod.quantidadeEstoque + "</td>" +
                            "<td><a href='/Produto/Editar/" + prod.id + "'>Editar</a></td>" + 
                            "<td><a href='/Produto/Deletar/" + prod.id + "'>Deletar</a></td>" + 
                        "</tr>";

                        tbody.append(node);
                    }
                },
                error: function(xhr,status,error){
                    prompt("Erro no carregamento de produtos!");
                }
            })
        })
    </script>
}